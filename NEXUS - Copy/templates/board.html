{% extends "base.html" %}
{% block content %}

<div class="dashboard-header text-center mt-4">
  <h2 class="page-title fw-bold text-primary">Welcome, {{ current_user.username }} ðŸ‘‹</h2>
  <p class="text-muted">Organize your projects visually using boards and collaborate with others.</p>

  <button class="btn btn-gradient mt-3 px-4 py-2" data-bs-toggle="modal" data-bs-target="#createBoardModal">
    + Create New Board
  </button>
</div>

<div class="container mt-4 text-center">
  <form method="GET" action="{{ url_for('dashboard') }}" class="d-flex justify-content-center">
    <input type="text" name="search" class="form-control w-50 shadow-sm"
      placeholder="ðŸ” Search boards by name..." value="{{ request.args.get('search', '') }}">
    <button type="submit" class="btn btn-primary ms-2 px-4">Search</button>
  </form>
</div>

<div class="boards-grid container mt-5 d-flex flex-wrap justify-content-center gap-4">
  {% if boards %}
    {% for board in boards %}
    <div class="board-card card shadow-sm p-4 text-center border-0" style="width: 280px;">
      <h4 class="board-title text-primary fw-bold">{{ board.name }}</h4>

      <p class="text-muted small mt-2">
        <i class="fa fa-user"></i> Owner: <strong>{{ board.owner.username }}</strong>
      </p>

      <div class="board-actions d-flex justify-content-center gap-2 mt-3">
        <a href="{{ url_for('view_board', board_id=board.id) }}" class="btn btn-sm btn-outline-primary" title="View Board">
          <i class="fa fa-eye"></i>
        </a>

        <a href="{{ url_for('board_stats', board_id=board.id) }}" class="btn btn-sm btn-info" title="View Stats">
          <i class="fa fa-chart-bar"></i>
        </a>

        <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editBoardModal{{ board.id }}">
          <i class="fa fa-edit"></i>
        </button>

        <form method="POST" action="{{ url_for('delete_board', board_id=board.id) }}" style="display:inline;"
          onsubmit="return confirm('Are you sure you want to delete this board?');">
          <button type="submit" class="btn btn-sm btn-danger"><i class="fa fa-trash"></i></button>
        </form>
      </div>
    </div>

    <div class="modal fade" id="editBoardModal{{ board.id }}" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-modal p-4">
          <div class="modal-header border-0">
            <h5 class="modal-title fw-bold text-primary">Edit Board</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>

          <form method="POST" action="{{ url_for('update_board', board_id=board.id) }}">
            <div class="modal-body">
              <input type="text" name="board_name" value="{{ board.name }}" class="form-control" required>
            </div>
            <div class="modal-footer border-0">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-warning">Update</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <div class="empty text-center text-muted mt-5">
      <p>No boards found. Try searching again or create a new one!</p>
    </div>
  {% endif %}
</div>

<div class="modal fade" id="createBoardModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content glass-modal p-4">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-bold text-primary">Create New Board</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form method="POST" action="{{ url_for('create_board') }}">
        <div class="modal-body">
          <input type="text" name="board_name" class="form-control" placeholder="Enter board name" required>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-gradient">Create</button>
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}
